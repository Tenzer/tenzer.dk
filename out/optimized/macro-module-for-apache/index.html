<!DOCTYPE html><html lang=en><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Macro module for Apache - Tenzer.dk</title><meta name=description content="The personal website and blog for Jeppe Fihl-Pearson about open source technologies and photography."><meta name=generator content="Hugo 0.62.2"><link rel=stylesheet href=/static/style.eb8df5db27.css integrity="sha256-QWp2zo3K1czNRQuaIVC4uedIqQw8b9WOS67d6jPYKDU="><link rel=logo href=/static/favicon.3dada7eb0a.svg type=image/svg+xml><link rel=icon href=/static/favicon.3dada7eb0a.svg sizes=any type=image/svg+xml><link rel=icon href=/static/favicon.e5c65e608b.png sizes=128x128 type=image/png><link rel=icon href=/static/favicon.copy.a23706216d.ico sizes="16x16 32x32 48x48 64x64" type=image/x-icon><link rel=alternate href=https://tenzer.dk/index.xml type=application/rss+xml title=Tenzer.dk><meta name=theme-color content=#2C3E50><meta property=og:type content=website><meta property=og:url content=https://tenzer.dk/macro-module-for-apache/ ><meta property=og:site_name content=Tenzer.dk><meta property=og:title content="Macro module for Apache - Tenzer.dk"><meta property=og:description content="This guide is about the wonderful mod_macro, which makes the job of managing an Apache webserver much easier, or just for the home developer with several test pages or projects.
I will explain how to get it running and give some examples of how I use the module, to help you get started with using it.
Installation First we need to get the module installed, since it is not installed in a default Debian/Ubuntu installation."><meta property=og:image content=https://tenzer.dk/images/logo.png><meta name=twitter:card content=summary><meta name=twitter:site content=@Tenzer><meta name=twitter:title content="Macro module for Apache - Tenzer.dk"><meta name=twitter:description content="This guide is about the wonderful mod_macro, which makes the job of managing an Apache webserver much easier, or just for the home developer with several test pages or projects.
I will explain how to get it running and give some examples of how I use the module, to help you get started with using it.
Installation First we need to get the module installed, since it is not installed in a default Debian/Ubuntu installation."><meta name=twitter:image content=https://tenzer.dk/images/logo.png></head><body><header><div class=header-container><a href=/ ><img id=logo src=/static/tenzerdk.90021cd24c.png alt="Tenzer.dk logo"></a></div></header><div class=container><div class=content><a href=/macro-module-for-apache/ ><h1>Macro module for Apache</h1></a><p class=posted-date>Posted on October 7, 2007</p><p>This guide is about the wonderful <a href=http://www.coelho.net/mod_macro/ >mod_macro</a>, which makes the job of managing an <a href=http://httpd.apache.org/ >Apache webserver</a> much easier, or just for the home developer with several test pages or projects.</p><p>I will explain how to get it running and give some examples of how I use the module, to help you get started with using it.</p><h2 id=installation>Installation</h2><p>First we need to get the module installed, since it is not installed in a default <a href=https://www.debian.org/ >Debian</a>/<a href=http://www.ubuntu.com/ >Ubuntu</a> installation. I presume you already have Apache2 installed, otherwise you should install that first. We can use APT to install the module, just run the following command as root:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>apt-get install libapache2-mod-macro</code></pre></div><p>Next we need to activate the module and restart Apache:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>a2enmod macro
/etc/init.d/apache2 restart</code></pre></div><p>And you are ready to use macros!</p><h2 id=basic-usage>Basic usage</h2><p>Before we are ready to make our config files, you should first learn how to use mod_macro. It basically adds one new function and a new tag, which now can be used in Apache's config files. The function <code>Use</code> and the tag <code>&lt;Macro&gt;</code>. We start of with the tag which is used to create a new macro. A simple static macro could look like the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#f92672>&lt;Macro</span> <span style=color:#e6db74>Logfile</span><span style=color:#f92672>&gt;</span>
    CustomLog <span style=color:#e6db74>/var/log/apache2/access.log</span> combined
    ErrorLog <span style=color:#e6db74>/var/log/apache2/error.log</span>
    LogLevel <span style=color:#66d9ef>warn</span>
<span style=color:#f92672>&lt;/Macro</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span></code></pre></div><p>The macro simply declares that the macro called <code>Logfile</code> contains the text within the <code>Macro</code> tags. In order to use the macro you just put the following line in your config file, where ever you normally would have put the lines from your macro:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>Use Logfile</code></pre></div><p>When you then reload Apache and it looks through the configuration files, then it automatically converts <code>Use Logfile</code> to the lines you have defined in your macro.</p><p>That was simple, but what do you do if you don't want all sites to log to the same file? You could create a logfile for each site, by declaring a variable which is then used in the macro:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#f92672>&lt;Macro</span> <span style=color:#e6db74>Logfiles $sitename</span><span style=color:#f92672>&gt;</span>
    CustomLog <span style=color:#e6db74>/var/log/apache2/</span>$sitename-access.log combined
    ErrorLog <span style=color:#e6db74>/var/log/apache2/</span>$sitename-error.log
    LogLevel <span style=color:#66d9ef>warn</span>
<span style=color:#f92672>&lt;/Macro</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span></code></pre></div><p>And the <code>Use</code> function to go with it:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>Use Logfiles tenzer.dk</code></pre></div><p>Neat, don't you think? If you then want to change the path to your logfiles, you only have to change it in your macro, and not in every config file you have got. The syntax for <code>Use</code> looks like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>Use &lt;Macroname&gt; [Variable <span style=color:#ae81ff>1</span>] [Variable <span style=color:#ae81ff>2</span>] ... [Variable x]</code></pre></div><p>Which basically means that you have to supply a name for the macro you are using, but the variables are optional.</p><p>A thing you need to remember when making macros, is that the file defining your macros needs to be included in Apache's configuration files somewhere, or else you will not be able to use them. I would suggest you to make a file called <code>macro.conf</code> inside the folder <code>/etc/apache2/conf.d/</code>, since all files in that folder automatically get included by Apache.</p><h2 id=advanced-usage>Advanced usage</h2><p>Macros are not limited to only be used for printing a few lines in Apache's configuration, it can also be used for entire <code>VirtualHost</code> declarations, like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache><span style=color:#f92672>&lt;Macro</span> <span style=color:#e6db74>VHost $type $hostname</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;VirtualHost</span> <span style=color:#e6db74>*</span><span style=color:#f92672>&gt;</span>
        ServerAdmin webmaster@$hostname

        Use $type $hostname

        ServerSignature <span style=color:#66d9ef>On</span>

        ServerName $hostname
        ServerAlias www.$hostname
    <span style=color:#f92672>&lt;/VirtualHost</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/Macro</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span>

<span style=color:#f92672>&lt;Macro</span> <span style=color:#e6db74>dir $hostname</span><span style=color:#f92672>&gt;</span>
    DocumentRoot <span style=color:#e6db74>/var/www/</span>$hostname

    CustomLog <span style=color:#e6db74>/var/log/apache2/</span>$hostname-access.log combined
    ErrorLog <span style=color:#e6db74>/var/log/apache2/</span>$hostname-error.log
    LogLevel <span style=color:#66d9ef>warn</span>
<span style=color:#f92672>&lt;/Macro</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span>

<span style=color:#f92672>&lt;Macro</span> <span style=color:#e6db74>cfg $hostname</span><span style=color:#f92672>&gt;</span>
    Include <span style=color:#e6db74>/var/www/conf.d/</span>$hostname.conf
<span style=color:#f92672>&lt;/Macro</span><span style=color:#e6db74></span><span style=color:#f92672>&gt;</span></code></pre></div><p>I should probably explain this since it can seem quite complicated at first sight. The macros are supplied with two variables, the first one called <code>$type</code>, which can either be set to <code>dir</code> or <code>cfg</code>, and the second variable called <code>$hostname</code> would be the hostname of the site, without "www." in front of it. The <code>$hostname</code> variable sets the name of the logfiles and also defines the ServerName with the domainname, and even adds a <code>ServerAlias</code> with "www." prefixed. The purpose of the <code>$type</code> variable is to give you the choice between making a custom config file for the <code>VirtualHost</code>, which would then be placed in <code>/var/www/conf.d/$hostname.conf</code>, or to use a predefined path for the <code>DocumentRoot</code> (<code>/var/www/$hostname/</code>).</p><p>This makes it very easy to get an overview of which sites you have added in Apache, since the list of virtual hosts would look like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>Use VHost dir tenzer.dk
Use VHost cfg example.com
<span style=color:#75715e># etc...</span></code></pre></div><p>This also makes it easier to script adding and deleting sites to the server, since you only have to look for one single line in the Apache configuration.</p><p>Do note that the macro module can be used in all of Apache's config files and not only for setting up virtual host.</p><p>I hope that you found this guide helpful, and please let me know of the ways you use mod_macro in your setup!</p></div></div><footer>Copyright © 2020 <a href=https://twitter.com/Tenzer>Jeppe Fihl-Pearson</a> unless otherwise noted.</footer></body></html>