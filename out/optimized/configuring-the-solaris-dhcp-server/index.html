<!DOCTYPE html><html lang=en><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Configuring the Solaris DHCP server - Tenzer.dk</title><meta name=description content="The personal website and blog for Jeppe Fihl-Pearson about open source technologies and photography."><meta name=generator content="Hugo 0.62.2"><link rel=stylesheet href=/static/style.eb8df5db27.css integrity="sha256-QWp2zo3K1czNRQuaIVC4uedIqQw8b9WOS67d6jPYKDU="><link rel=logo href=/static/favicon.3dada7eb0a.svg type=image/svg+xml><link rel=icon href=/static/favicon.3dada7eb0a.svg sizes=any type=image/svg+xml><link rel=icon href=/static/favicon.e5c65e608b.png sizes=128x128 type=image/png><link rel=icon href=/static/favicon.copy.a23706216d.ico sizes="16x16 32x32 48x48 64x64" type=image/x-icon><link rel=alternate href=https://tenzer.dk/index.xml type=application/rss+xml title=Tenzer.dk><meta name=theme-color content=#2C3E50><meta property=og:type content=website><meta property=og:url content=https://tenzer.dk/configuring-the-solaris-dhcp-server/ ><meta property=og:site_name content=Tenzer.dk><meta property=og:title content="Configuring the Solaris DHCP server - Tenzer.dk"><meta property=og:description content="As I recently had to configure the Solaris bundled DHCP server on a box, I though that I would write down the steps I took to get the task done, for everybody else to use and also for myself later on.
I will configure the server with some static entries for specific hosts, and also with a small pool of addresses for random users.
In order to get the DHCP server installed on OpenSolaris, you have to install the package named SUNWdhcs."><meta property=og:image content=https://tenzer.dk/images/logo.png><meta name=twitter:card content=summary><meta name=twitter:site content=@Tenzer><meta name=twitter:title content="Configuring the Solaris DHCP server - Tenzer.dk"><meta name=twitter:description content="As I recently had to configure the Solaris bundled DHCP server on a box, I though that I would write down the steps I took to get the task done, for everybody else to use and also for myself later on.
I will configure the server with some static entries for specific hosts, and also with a small pool of addresses for random users.
In order to get the DHCP server installed on OpenSolaris, you have to install the package named SUNWdhcs."><meta name=twitter:image content=https://tenzer.dk/images/logo.png></head><body><header><div class=header-container><a href=/ ><img id=logo src=/static/tenzerdk.90021cd24c.png alt="Tenzer.dk logo"></a></div></header><div class=container><div class=content><a href=/configuring-the-solaris-dhcp-server/ ><h1>Configuring the Solaris DHCP server</h1></a><p class=posted-date>Posted on May 23, 2009</p><p>As I recently had to configure the Solaris bundled DHCP server on a box, I though that I would write down the steps I took to get the task done, for everybody else to use and also for myself later on.</p><p>I will configure the server with some static entries for specific hosts, and also with a small pool of addresses for random users.</p><p>In order to get the DHCP server installed on OpenSolaris, you have to install the package named <code>SUNWdhcs</code>. This is done by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec pkg install SUNWdhcs</code></pre></div><p>After the installation, you should start of by using the <code>dhcpconfig</code> command to set up the initial configuration directory to hold the settings used by the DHCP server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec dhcpconfig -D -r SUNWfiles -p /var/dhcp -a 192.168.0.1 -d tenzer.lan -h files -l <span style=color:#ae81ff>86400</span></code></pre></div><p>Parameters:</p><ul><li><code>-D</code> - Specify that we setting up a new instance of the DHCP service.</li><li><code>-r SUNWfiles</code> - We want a plain text file store. Other options are SUNWbinfiles and SUNWnisplus, but I wont be covering those here.</li><li><code>-p /var/dhcp</code> - An absolute path to where the configuration files should be stored.</li><li><code>-a 192.168.0.1</code> - The DNS server to use on the LAN.</li><li><code>-d tenzer.lan</code> - The domain name to use for the network.</li><li><code>-h files</code> - Specify where the host informations should be stored. Other values are <code>nisplus</code> and <code>dns</code>.</li><li><code>-l 86400</code> - The lease time in seconds. 86400 seconds = 24 hours.</li></ul><p>After that you have to create the network we are going to set up. This is done with the following command:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec dhcpconfig -N 192.168.0.0 -m 255.255.255.0 -t 192.168.0.1</code></pre></div><p>Parameters:</p><ul><li><code>-N 192.168.0.0</code> - Create a new network with the specified network address.</li><li><code>-m 255.255.255.0</code> - The network mask to use for the network.</li><li><code>-t 192.168.0.1</code> - Specifies the default gateway.</li></ul><p>All the above entered network settings are put into macros, which each is a small assembly of configuration options, and which makes it easier to put a group of settings on specific hosts. You can see which macros there is currently created and their settings by running:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>dhtadm -P</code></pre></div><p>You will see that there are three macros created. One macro is named after your servers hostname, and contains the settings specified as system wide settings with the first <code>dhcpconfig</code> command. One has the name of the network you just created, and contains those settings entered in the last command. The last macro named <code>Locale</code> simply holds timezone information, with a setting claiming the amount of seconds your local timezone differs from UTC.</p><p>As you can see from the output, the current timeserver specified is set to <code>127.0.0.1</code> which aren't going to do any good for the DHCP clients, so we are going to correct that to <code>192.168.0.1</code>, the same address used by our default gateway and DNS server. The change is done like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec dhtadm -M -m <span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span> -e Timeserv<span style=color:#f92672>=</span>192.168.0.1</code></pre></div><p>Parameters:</p><ul><li><code>-M</code> - We are going to modify a macro.</li><li><code>-m $(hostname)</code> - This is the macro we are going to modify. $(hostname) will be replaced with your servers hostname by the shell.</li><li><code>-e Timeserv=192.168.0.1</code> - The setting we want to change, and what it should be changed to.</li></ul><p>Again, you can check that the setting is indeed changed with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>dhtadm -P</code></pre></div><p>We are also going to alter the 192.168.0.0 macro, and set it to include the settings from the macro named after the hostname:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec -M -m 192.168.0.0 -e Include<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>hostname<span style=color:#66d9ef>)</span></code></pre></div><p>The third command used to configure the DHCP server is <code>pntadm</code>, which sets up settings for each host on the network. The following command adds a static DHCP entry for a host:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec pntadm -A 192.168.0.2 -c <span style=color:#e6db74>"Comment"</span> -f MANUAL -i 01001BFC92BC10 -m 192.168.0.0 -y 192.168.0.0</code></pre></div><p>Parameters:</p><ul><li><code>-A 192.168.0.2</code> - Add the IP address 192.168.0.2.</li><li><code>-c "Comment"</code> - Specify a comment for the entry, for your own convenience.</li><li><code>-f MANUAL</code> - We set the flag MANUAL in order to only assign this IP address to the MAC address specified.</li><li><code>-i 01001BFC92BC10</code> - This sets the MAC address (Client_ID) for the host this entry goes for. Should be prepended with "01" to specify this is ethernet.</li><li><code>-m 192.168.0.0</code> - This host is going to use the "192.168.0.0" macro.</li><li><code>-y</code> - Verify that the macro entered actually exist.</li><li><code>192.168.0.0</code> - This is the network the address is assigned to.</li></ul><p>The command to check the settings is:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pntadm -P 192.168.0.0</code></pre></div><p>And now we add an IP address for any host on the network:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec pntadm -A 192.168.0.10 -m 192.168.0.0 -y 192.168.0.0</code></pre></div><p>The same parameters account as before, but we have just left out a lot more options, since we don't know which host is going to get this address.</p><p>The last thing to do, is to restart the DHCP server, in order for all the changes to take effect:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pfexec svcadm restart dhcp-server</code></pre></div><p>And then you are done.</p><p>References: <a href="http://docs.sun.com/app/docs/doc/816-4554/dhcptm-1?a=view">docs.sun.com</a> and man pages.</p></div></div><footer>Copyright © 2020 <a href=https://twitter.com/Tenzer>Jeppe Fihl-Pearson</a> unless otherwise noted.</footer></body></html>