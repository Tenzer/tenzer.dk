<!DOCTYPE html><html lang=en><head prefix="og: http://ogp.me/ns#"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Installing djbdns in an OpenSolaris zone - Tenzer.dk</title><meta name=description content="The personal website and blog for Jeppe Fihl-Pearson about open source technologies and photography."><meta name=generator content="Hugo 0.62.2"><style>body{background-color:#ecf0f1;color:#2c3e50;font-family:Georgia,serif;font-size:20px;line-height:1.6em;margin:0}a{color:#e74c3c;text-decoration:none}a h1{color:#2c3e50}hr{color:#8c97a1}header{background:#2c3e50;color:#ecf0f1;text-align:left}.header-container{margin:auto;max-width:700px;padding:10px}#logo{margin:10px 0;max-height:60px;max-width:100%}nav{display:-webkit-flex;display:flex;font-size:1rem;margin-bottom:20px;max-width:400px}nav a{color:#e74c3c}nav a,nav span{-webkit-flex:1;flex:1}nav span.disabled{color:#8c97a1}.container{background-image:linear-gradient(rgba(44,62,80,.4),rgba(44,62,80,0));background-image:-webkit-linear-gradient(top,rgba(44,62,80,.4),rgba(44,62,80,0));background-repeat:repeat-x;background-size:auto 20px;padding-top:20px}.content{margin:auto;max-width:700px;padding:0 10px}.content img{display:block;margin:auto;max-width:100%}.posted-date{color:#8c97a1;font-size:1rem;margin-top:0}h1{line-height:1;margin-bottom:.5rem}pre{border:1px dashed #cfd9db;line-height:1.25em;max-width:700px;overflow:auto;padding:5px 10px}pre code{background-color:inherit;border:none;padding:0}code{background-color:#f5f7f7;border:1px dashed #cfd9db;padding:5px}blockquote{border-left:3px solid #507192;color:#3e5871;font-style:italic;margin-left:20px;padding-left:10px}ul li{list-style-type:circle}.admonition-title{font-weight:700}.admonition{border:1px solid #2c3e50;border-radius:3px;margin:20px 0;padding:0 5px}.admonition p:first-child{margin-top:5px}.admonition p:last-child{margin-bottom:5px}.admonition.attention,.admonition.warning{background-color:#ffd34e}[data-expounder-c],[data-expounder]{text-decoration:none;border-bottom:1px dashed;cursor:pointer}@keyframes expoundedFadeIn{0%{opacity:0}to{opacity:1}}@keyframes expoundedFadeOut{0%{opacity:1}to{opacity:0}}[data-expounded]{display:none}[data-expounded].expounded-appear{display:initial;animation:expoundedFadeIn 1s}[data-expounded].expounded-disappear{display:initial;animation:expoundedFadeOut 1s}footer{font-size:15px;margin:auto;max-width:700px;text-align:center}@media print{footer,header{display:none}}</style><link rel=logo href=/static/favicon.3dada7eb0a.svg type=image/svg+xml><link rel=icon href=/static/favicon.3dada7eb0a.svg sizes=any type=image/svg+xml><link rel=icon href=/static/favicon.e5c65e608b.png sizes=128x128 type=image/png><link rel=icon href=/static/favicon.copy.a23706216d.ico sizes="16x16 32x32 48x48 64x64" type=image/x-icon><link rel=alternate href=https://tenzer.dk/index.xml type=application/rss+xml title=Tenzer.dk><meta name=theme-color content=#2C3E50><meta property=og:type content=website><meta property=og:url content=https://tenzer.dk/installing-djbdns-in-an-opensolaris-zone/ ><meta property=og:site_name content=Tenzer.dk><meta property=og:title content="Installing djbdns in an OpenSolaris zone - Tenzer.dk"><meta property=og:description content="This guide shows you how to install djbdns in an OpenSolaris zone. The zone is currently running OpenSolaris build 124, but the guide should work on other versions of OpenSolaris as well, though not tested. The zone is simply set up as a default ipkg OpenSolaris zone, without many default installed packages.
First we start of with the installation of some packages, including sunstudio since we are going to use that to compile djbdns with:"><meta property=og:image content=https://tenzer.dk/images/logo.png><meta name=twitter:card content=summary><meta name=twitter:site content=@Tenzer><meta name=twitter:title content="Installing djbdns in an OpenSolaris zone - Tenzer.dk"><meta name=twitter:description content="This guide shows you how to install djbdns in an OpenSolaris zone. The zone is currently running OpenSolaris build 124, but the guide should work on other versions of OpenSolaris as well, though not tested. The zone is simply set up as a default ipkg OpenSolaris zone, without many default installed packages.
First we start of with the installation of some packages, including sunstudio since we are going to use that to compile djbdns with:"><meta name=twitter:image content=https://tenzer.dk/images/logo.png></head><body><header><div class=header-container><a href=/ ><img id=logo src=/static/tenzerdk.90021cd24c.png alt="Tenzer.dk logo"></a></div></header><div class=container><div class=content><a href=/installing-djbdns-in-an-opensolaris-zone/ ><h1>Installing djbdns in an OpenSolaris zone</h1></a><p class=posted-date>Posted on October 5, 2009. Reading time: 3 minutes</p><p>This guide shows you how to install <a href=http://cr.yp.to/djbdns.html>djbdns</a> in an OpenSolaris zone. The zone is currently running OpenSolaris build 124, but the guide should work on other versions of OpenSolaris as well, though not tested. The zone is simply set up as a default ipkg OpenSolaris zone, without many default installed packages.</p><p>First we start of with the installation of some packages, including <code>sunstudio</code> since we are going to use that to compile djbdns with:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>pkg install sunstudio SUNWbtool</code></pre></div><p>That is probably going to take a while, since ~400 MB has to be downloaded.</p><h2 id=daemontools>daemontools</h2><p>You will first have to install <a href=http://cr.yp.to/daemontools.html>daemontools</a> before we can move on. daemontools is used to start and stop the dnscache and tinydns services, plus making sure they are started again in case an issue should happen.</p><p>Start by downloading the source code for daemontools, and extract it afterwards:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl -O http://cr.yp.to/daemontools/daemontools-0.76.tar.gz
gunzip daemontools-0.76.tar.gz
tar xf daemontools-0.76.tar</code></pre></div><p>Enter the newly extracted directory, and make a few modifications in order to use the Sun Studio compiler instead of GCC before trying to compile:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd admin/daemontools-0.76
echo <span style=color:#e6db74>"cc -O2"</span> &gt; src/conf-cc
echo <span style=color:#e6db74>"cc -s"</span> &gt; src/conf-ld
package/install</code></pre></div><p>Now there has been added a line to <code>/etc/inittab</code> which is supposed to keep the <code>svscan</code> service running at all times. However, that line does not work properly on Solaris machines, which causes <code>svscan</code> to restart every ten minutes. So you will have to edit the last line in <code>/etc/inittab</code> concerning <code>svscanboot</code>, and replace the line with the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>SV:123456:respawn:/command/svscanboot &gt; /dev/msglog 2&gt;&amp;1 &lt; /dev/null</code></pre></div><p>After that is done you have to reload <code>init</code>, in order for it to pick up the new line. This is simply done by executing <code>init q</code>. And daemontools is now installed and running.</p><p>Note that the executables installed can either be found in:</p><ol><li>The <code>command/</code> folder under which daemontools was extracted</li><li>Under <code>/command/</code> or</li><li>Inside <code>/usr/local/bin/</code>. Feel free to add any of these folder to your <code>PATH</code> variable, or specify the full path when you want to use the programs.</li></ol><h2 id=ucspi-tcp>ucspi-tcp</h2><p>Next up is <a href=http://cr.yp.to/ucspi-tcp.html>ucspi-tcp</a> which enables services to listen on TCP ports through the <code>tcpclient</code> and <code>tcpserver</code> commands.</p><p>Again, download and extract:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl -O http://cr.yp.to/ucspi-tcp/ucspi-tcp-0.88.tar.gz
gunzip ucspi-tcp-0.88.tar.gz
tar xf ucspi-tcp-0.88.tar</code></pre></div><p>We are basically doing the same modifications to ucspi-tcp as we did to daemontools:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd ucspi-tcp-0.88
echo <span style=color:#e6db74>"cc -O2"</span> &gt; conf-cc
echo <span style=color:#e6db74>"cc -s"</span> &gt; conf-ld
make
make setup check</code></pre></div><p>The installed binaries has been put inside <code>/usr/local/bin/</code>.</p><h2 id=djbdns>djbdns</h2><p>Finally we are going to install the <a href=http://cr.yp.to/djbdns.html>djbdns</a> package, which among others, contains the <code>dnscache</code> and <code>tinydns</code> servers.</p><p>Start of with the downloading and extracting:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>curl -O http://cr.yp.to/djbdns/djbdns-1.05.tar.gz
gunzip djbdns-1.05.tar.gz
tar xf djbdns-1.05.tar</code></pre></div><p>And once again, we will have to change the compiler settings before compiling</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>cd djbdns-1.05
echo <span style=color:#e6db74>"cc -O2"</span> &gt; conf-cc
echo <span style=color:#e6db74>"cc -s"</span> &gt; conf-ld
make
make setup check</code></pre></div><p>And then you are done. The binaries has been installed in <code>/usr/local/bin/</code>.</p><p>Since there are already many guides on setting up dnscache and tinydns, I won't cover that here, but rather just focus on the OpenSolaris specific changes there's needed in order to compile the above three pieces of software.</p><p>I have made some spec files for the three packages above, so they may in the future be available pre-compiled in the package system, but for now you have to do with this guide.</p></div></div><footer>Copyright © 2020 <a href=https://twitter.com/Tenzer>Jeppe Fihl-Pearson</a> unless otherwise noted.</footer></body></html>